<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeniusERP - Test Control Panel</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 42px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      font-size: 18px;
      opacity: 0.9;
    }

    .panel {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }

    .status-display {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .status-dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status-dot.idle {
      background: #6c757d;
      animation: none;
    }

    .status-dot.running {
      background: #28a745;
    }

    .status-dot.stopping {
      background: #ffc107;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    .status-text {
      font-size: 18px;
      font-weight: bold;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .btn {
      padding: 15px 25px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-start {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }

    .btn-stop {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }

    .btn-restart {
      background: linear-gradient(135deg, #ffc107, #ff9800);
      color: white;
    }

    .btn-clear-logs {
      background: linear-gradient(135deg, #17a2b8, #138496);
      color: white;
    }

    .btn-clear-metrics {
      background: linear-gradient(135deg, #6f42c1, #5a32a3);
      color: white;
    }

    .btn-refresh {
      background: linear-gradient(135deg, #6c757d, #545b62);
      color: white;
    }

    .config-form {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #495057;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 2px solid #dee2e6;
      border-radius: 6px;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .checkbox-group {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logs-display {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.5;
    }

    .log-entry {
      margin-bottom: 8px;
      padding: 4px 0;
      border-bottom: 1px solid #333;
    }

    .log-time {
      color: #858585;
    }

    .log-level {
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 3px;
    }

    .log-level.info {
      background: #007acc;
      color: white;
    }

    .log-level.error {
      background: #f48771;
      color: white;
    }

    .log-level.warn {
      background: #ff9800;
      color: white;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      color: white;
      font-weight: bold;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .notification.success {
      background: #28a745;
    }

    .notification.error {
      background: #dc3545;
    }

    .notification.info {
      background: #17a2b8;
    }

    .section-title {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéÆ GeniusERP Test Control Panel</h1>
      <p>Control Central pentru Orchestrator Teste</p>
    </div>

    <div class="panel">
      <div class="status-display">
        <div class="status-indicator">
          <div class="status-dot idle" id="statusDot"></div>
          <span class="status-text" id="statusText">Status: Idle</span>
        </div>
        <div id="uptimeDisplay"></div>
      </div>

      <h2 class="section-title">‚öôÔ∏è Controale</h2>
      <div class="controls">
        <button class="btn btn-start" id="btnStart">
          ‚ñ∂Ô∏è Start Teste
        </button>
        <button class="btn btn-stop" id="btnStop" disabled>
          ‚èπÔ∏è Stop Teste
        </button>
        <button class="btn btn-restart" id="btnRestart">
          üîÑ Restart
        </button>
        <button class="btn btn-clear-logs" id="btnClearLogs">
          üßπ Clear Logs
        </button>
        <button class="btn btn-clear-metrics" id="btnClearMetrics">
          üìä Reset Metrics
        </button>
        <button class="btn btn-refresh" id="btnRefresh">
          üîÑ Refresh Status
        </button>
      </div>

      <h2 class="section-title">üõ†Ô∏è Configura»õie Teste</h2>
      <div class="config-form">
        <div class="form-group">
          <label for="modules">Module (separa»õi prin virgulƒÉ sau "all"):</label>
          <input type="text" id="modules" value="all" placeholder="admin,accounting,auth...">
        </div>
        <div class="form-group">
          <label>Tipuri Teste:</label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="typeAll" checked>
              <label for="typeAll">All</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="typeUnit">
              <label for="typeUnit">Unit</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="typeIntegration">
              <label for="typeIntegration">Integration</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="typeE2e">
              <label for="typeE2e">E2E</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="typePerformance">
              <label for="typePerformance">Performance</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="typeSecurity">
              <label for="typeSecurity">Security</label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="parallel">Workers Paraleli:</label>
          <input type="number" id="parallel" value="4" min="1" max="16">
        </div>
        <div class="form-group">
          <div class="checkbox-item">
            <input type="checkbox" id="verbose" checked>
            <label for="verbose">Verbose Logging</label>
          </div>
        </div>
        <div class="form-group">
          <div class="checkbox-item">
            <input type="checkbox" id="failFast">
            <label for="failFast">Fail Fast (oprire la primul e»ôec)</label>
          </div>
        </div>
      </div>

      <h2 class="section-title">üìú Recent Logs</h2>
      <div class="logs-display" id="logsDisplay">
        <div class="log-entry">Waiting for logs...</div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:9091';
    let statusInterval;

    // Elements
    const btnStart = document.getElementById('btnStart');
    const btnStop = document.getElementById('btnStop');
    const btnRestart = document.getElementById('btnRestart');
    const btnClearLogs = document.getElementById('btnClearLogs');
    const btnClearMetrics = document.getElementById('btnClearMetrics');
    const btnRefresh = document.getElementById('btnRefresh');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const uptimeDisplay = document.getElementById('uptimeDisplay');
    const logsDisplay = document.getElementById('logsDisplay');

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Update status
    async function updateStatus() {
      try {
        const response = await fetch(`${API_BASE}/status`);
        const data = await response.json();
        
        statusDot.className = `status-dot ${data.status}`;
        statusText.textContent = `Status: ${data.status.toUpperCase()}`;
        
        if (data.uptime > 0) {
          const minutes = Math.floor(data.uptime / 60000);
          const seconds = Math.floor((data.uptime % 60000) / 1000);
          uptimeDisplay.textContent = `Uptime: ${minutes}m ${seconds}s`;
        } else {
          uptimeDisplay.textContent = '';
        }
        
        // Update buttons
        btnStart.disabled = data.status === 'running';
        btnStop.disabled = data.status !== 'running';
        
      } catch (error) {
        console.error('Error updating status:', error);
        statusText.textContent = 'Status: ERROR (API offline?)';
      }
    }

    // Update logs
    async function updateLogs() {
      try {
        const response = await fetch(`${API_BASE}/logs?lines=50`);
        const data = await response.json();
        
        if (data.logs && data.logs.length > 0) {
          logsDisplay.innerHTML = data.logs.map(log => {
            const time = log.timestamp || new Date().toISOString();
            const level = log.level || log.severity || 'info';
            const message = log.message || JSON.stringify(log);
            
            return `<div class="log-entry">
              <span class="log-time">[${time.substring(11, 19)}]</span>
              <span class="log-level ${level}">${level.toUpperCase()}</span>
              ${message}
            </div>`;
          }).join('');
          
          logsDisplay.scrollTop = logsDisplay.scrollHeight;
        }
      } catch (error) {
        console.error('Error updating logs:', error);
      }
    }

    // Get test config
    function getTestConfig() {
      const modules = document.getElementById('modules').value
        .split(',')
        .map(m => m.trim())
        .filter(m => m);
      
      const types = [];
      if (document.getElementById('typeAll').checked) {
        types.push('all');
      } else {
        if (document.getElementById('typeUnit').checked) types.push('unit');
        if (document.getElementById('typeIntegration').checked) types.push('integration');
        if (document.getElementById('typeE2e').checked) types.push('e2e');
        if (document.getElementById('typePerformance').checked) types.push('performance');
        if (document.getElementById('typeSecurity').checked) types.push('security');
      }
      
      return {
        modules: modules.length > 0 ? modules : ['all'],
        types: types.length > 0 ? types : ['all'],
        parallel: parseInt(document.getElementById('parallel').value),
        verbose: document.getElementById('verbose').checked,
        dashboard: true,
        failFast: document.getElementById('failFast').checked,
      };
    }

    // Event Listeners
    btnStart.addEventListener('click', async () => {
      try {
        const config = getTestConfig();
        const response = await fetch(`${API_BASE}/start`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(config),
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification('Teste pornite cu succes!', 'success');
        } else {
          showNotification(data.error || 'Eroare la pornirea testelor', 'error');
        }
        
        updateStatus();
      } catch (error) {
        showNotification('Eroare la pornirea testelor', 'error');
        console.error(error);
      }
    });

    btnStop.addEventListener('click', async () => {
      try {
        const response = await fetch(`${API_BASE}/stop`, {
          method: 'POST',
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification('Teste oprite cu succes!', 'success');
        } else {
          showNotification(data.error || 'Eroare la oprirea testelor', 'error');
        }
        
        updateStatus();
      } catch (error) {
        showNotification('Eroare la oprirea testelor', 'error');
        console.error(error);
      }
    });

    btnRestart.addEventListener('click', async () => {
      try {
        const config = getTestConfig();
        const response = await fetch(`${API_BASE}/restart`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(config),
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification('Orchestrator restartat cu succes!', 'success');
        } else {
          showNotification(data.error || 'Eroare la restart', 'error');
        }
        
        updateStatus();
      } catch (error) {
        showNotification('Eroare la restart', 'error');
        console.error(error);
      }
    });

    btnClearLogs.addEventListener('click', async () => {
      if (!confirm('Sigur dori»õi sƒÉ »ôterge»õi toate log-urile?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/clear-logs`, {
          method: 'POST',
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification(`Logs »ôterse: ${data.freedSpace} eliberat`, 'success');
          logsDisplay.innerHTML = '<div class="log-entry">Logs cleared.</div>';
        } else {
          showNotification(data.error || 'Eroare la »ôtergerea logs', 'error');
        }
      } catch (error) {
        showNotification('Eroare la »ôtergerea logs', 'error');
        console.error(error);
      }
    });

    btnClearMetrics.addEventListener('click', async () => {
      if (!confirm('Sigur dori»õi sƒÉ reseta»õi toate metrics-urile?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/clear-metrics`, {
          method: 'POST',
        });
        
        const data = await response.json();
        
        if (data.success) {
          showNotification('Metrics resetate cu succes!', 'success');
        } else {
          showNotification(data.error || 'Eroare la resetarea metrics', 'error');
        }
      } catch (error) {
        showNotification('Eroare la resetarea metrics', 'error');
        console.error(error);
      }
    });

    btnRefresh.addEventListener('click', () => {
      updateStatus();
      updateLogs();
      showNotification('Status actualizat', 'info');
    });

    // Auto-update
    updateStatus();
    updateLogs();
    
    statusInterval = setInterval(() => {
      updateStatus();
      updateLogs();
    }, 5000); // Update every 5 seconds

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (statusInterval) {
        clearInterval(statusInterval);
      }
    });
  </script>
</body>
</html>

