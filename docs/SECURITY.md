# Ghid de Securitate GeniusERP

## Cuprins
1. [Introducere](#introducere)
2. [Configurare SigurƒÉ](#configurare-sigurƒÉ)
3. [Logging Securizat](#logging-securizat)
4. [Autentificare »ôi Autorizare](#autentificare-»ôi-autorizare)
5. [Protec»õie √émpotriva Atacurilor](#protec»õie-√Æmpotriva-atacurilor)
6. [Gestionarea Secretelor](#gestionarea-secretelor)
7. [Deployment Securizat](#deployment-securizat)
8. [Incident Response](#incident-response)
9. [Security Checklist](#security-checklist)

---

## Introducere

GeniusERP implementeazƒÉ un sistem complet de securitate conform standardelor OWASP Top 10 2021. Acest ghid documenteazƒÉ toate aspectele de securitate »ôi procedurile recomandate.

### Principii de Securitate

1. **Defense in Depth** - Securitate pe multiple niveluri
2. **Least Privilege** - Acces minimal necesar
3. **Secure by Default** - ConfigurƒÉri sigure din start
4. **Zero Trust** - Verificare continuƒÉ
5. **Privacy by Design** - Protec»õia datelor √ÆncorporatƒÉ

---

## Configurare SigurƒÉ

### Variabile de Mediu Obligatorii

#### Production (.env.production)

```env
# ===========================================
# CONFIGURARE MINIMƒÇ NECESARƒÇ PENTRU PRODUC»öIE
# ===========================================

# ----------------
# URLs »ôi Porturi
# ----------------
VITE_API_BASE_URL=https://geniuserp.app/api
VITE_APP_URL=https://geniuserp.app
VITE_FRONTEND_PORT=443
VITE_BACKEND_PORT=5001
VITE_DB_PORT=5432

# ----------------
# CORS (CRITIC!)
# ----------------
CORS_ORIGINS=https://geniuserp.app

# ----------------
# Logging
# ----------------
VITE_LOG_LEVEL=error
VITE_ENABLE_SENSITIVE_LOGS=false
VITE_ENABLE_DEBUG_LOGS=false

# ----------------
# JWT (GENERAT SECURIZAT!)
# ----------------
JWT_SECRET=[GENERAT CU: openssl rand -base64 64]
JWT_REFRESH_SECRET=[DIFERIT DE JWT_SECRET]
JWT_EXPIRY=900

# ----------------
# Database
# ----------------
DATABASE_URL=postgresql://[USER]:[PASS]@[HOST]:[PORT]/[DB]
DB_SSL_MODE=require

# ----------------
# Sentry
# ----------------
VITE_SENTRY_DSN=https://[KEY]@[ORG].ingest.sentry.io/[PROJECT]
VITE_SENTRY_ENVIRONMENT=production
VITE_ENABLE_SENTRY=true

# ----------------
# Security
# ----------------
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
SESSION_TIMEOUT=1800000
```

#### Development (.env.development)

```env
# Logging verbose pentru debugging
VITE_LOG_LEVEL=debug
VITE_ENABLE_SENSITIVE_LOGS=true
VITE_ENABLE_DEBUG_LOGS=true

# URLs locale
VITE_API_BASE_URL=http://localhost:5001/api
VITE_APP_URL=http://localhost:5000

# CORS permissive pentru development
CORS_ORIGINS=http://localhost:5000,http://0.0.0.0:5000,http://127.0.0.1:5000

# JWT pentru development (NU folosi»õi √Æn production!)
JWT_SECRET=dev-secret-key-DO-NOT-USE-IN-PRODUCTION
JWT_REFRESH_SECRET=dev-refresh-secret-DO-NOT-USE-IN-PRODUCTION

# Sentry disable √Æn development (op»õional)
VITE_ENABLE_SENTRY=false
```

### Generare Secrete Sigure

```bash
# JWT Secret (64 bytes)
openssl rand -base64 64

# JWT Refresh Secret (diferit!)
openssl rand -base64 64

# Database Password (32 caractere alfanumerice + simboluri)
openssl rand -base64 32 | tr -d "=+/" | cut -c1-32
```

‚ö†Ô∏è **IMPORTANT:** Nu folosi»õi niciodatƒÉ acela»ôi secret pentru JWT_SECRET »ôi JWT_REFRESH_SECRET!

---

## Logging Securizat

### Utilizare Security Logger

GeniusERP include un sistem complet de logging securizat care **obfuscƒÉ automat** datele sensibile.

#### Import »ôi Utilizare

```typescript
import { logger, maskToken, maskUUID } from '@/lib/utils/security-logger';

// Logging de bazƒÉ (obfuscare automatƒÉ)
logger.debug('User authenticated', { 
  userId: user.id,           // Va fi obfuscat automat
  companyId: user.companyId, // Va fi obfuscat automat
  token: user.token          // Va fi obfuscat automat
});

// Output √Æn DEV: "userId: f74b89a3-...-cff7039b8c2d"
// Output √Æn PROD: Silent (doar errors)
```

#### Nivele de Logging

```typescript
logger.debug(message, data);  // Doar √Æn development
logger.info(message, data);   // Important info √Æn ambele medii
logger.warn(message, data);   // Warning-uri √Æn ambele medii
logger.error(message, data);  // Errors √Æn ambele medii
```

#### Func»õii Speciale

```typescript
// Log token securizat
logger.logToken('Auth context', jwtToken);
// Output: "Auth context: eyJhbG...c2d"

// Log UUID securizat
logger.logUUID('Company ID', companyId);
// Output: "Company ID: c2e78d7d-...-f68d8cc6e4a1"

// Log API request (URL obfuscat)
logger.logRequest('POST', '/api/auth/login', { username });
// Output: "API Request: POST https://***"

// Log API response (date obfuscate)
logger.logResponse(url, 200, responseData);
// Toate datele sensibile din response sunt obfuscate automat
```

### Ce Date Sunt Obfuscate Automat

Func»õia `maskSensitiveData()` detecteazƒÉ »ôi obfuscƒÉ automat:

| Tip Date | Pattern Detectat | Format Obfuscat | Exemplu |
|----------|------------------|-----------------|---------|
| JWT Token | `token`, `jwt`, `authorization`, `bearer` | eyJhbG...c2d | eyJhbGciOi...9b8c |
| UUID | `uuid`, `id` + format valid | f74b89a3-...-cff7039b8c2d | f74b89a3-5801-...-cff7039b8c2d |
| Password | `password`, `pwd`, `secret` | ***PASSWORD:LENGTH_X*** | ***PASSWORD:LENGTH_12*** |
| Email | `email`, `mail` | u***@domain.com | a***@example.com |
| API Key | `apikey`, `api_key` | sk_...xyz | sk_live...xyz |
| IP Address | `ip`, `address` | 192.168.***.** | 192.168.***.** |
| URL | `url`, `uri` | https://domain.com/*** | https://example.com/*** |

### Best Practices Logging

#### ‚úÖ DO (Bine)

```typescript
// 1. Folose»ôte logger, NU console.log direct
logger.info('User logged in');

// 2. AdaugƒÉ context util (va fi obfuscat automat)
logger.debug('Processing payment', {
  userId: user.id,        // Auto-obfuscat
  amount: payment.amount, // OK sƒÉ logezi
  currency: 'RON'         // OK sƒÉ logezi
});

// 3. Log-uri structurate pentru analizƒÉ
logger.error('Payment failed', {
  error: error.message,
  code: error.code,
  userId: maskUUID(user.id) // Explicit masking
});
```

#### ‚ùå DON'T (Gre»ôit)

```typescript
// 1. NU folosi console.log direct pentru date sensibile
console.log('Token:', user.token); // ‚ùå VULNERABIL

// 2. NU loga creden»õiale NICIODATƒÇ
logger.debug('Login attempt', { 
  username: credentials.username, // ‚ùå NU FACE ASTA
  password: credentials.password  // ‚ùå NU FACE ASTA NICIODATƒÇ
});

// 3. NU loga UUID-uri √Æntregi neobfuscate
console.log('User ID:', user.id); // ‚ùå Folose»ôte maskUUID()
```

---

## Autentificare »ôi Autorizare

### Flux Autentificare

```
1. User -> POST /api/auth/login { username, password }
2. Backend verificƒÉ creden»õiale
3. Backend genereazƒÉ JWT cu expiry 15 min
4. Frontend stocheazƒÉ { user, token } √Æn localStorage
5. Frontend adaugƒÉ Bearer token √Æn toate request-uri
6. Auto-refresh la fiecare 15 minute
7. Logout -> invalidare token + clear localStorage
```

### JWT Structure

```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "id": "user-uuid",
    "companyId": "company-uuid",
    "roles": ["user"],
    "iat": 1234567890,
    "exp": 1234568790
  }
}
```

### Protected Route Example

```typescript
import { useAuth } from '@/hooks/use-auth';

function ProtectedRoute({ children }) {
  const { user } = useAuth();
  
  if (!user) {
    return <Navigate to="/auth" />;
  }
  
  return <>{children}</>;
}
```

### API Authorization Check

```typescript
// Backend middleware
export function requireAuth(req, res, next) {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).json({ message: 'No token provided' });
  }
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;
    next();
  } catch (error) {
    return res.status(401).json({ message: 'Invalid token' });
  }
}
```

---

## Protec»õie √émpotriva Atacurilor

### SQL Injection Protection ‚úÖ

**Mecanism:** Drizzle ORM cu prepared statements

```typescript
// ‚úÖ SIGUR - Parametrizat
const users = await db
  .select()
  .from(usersTable)
  .where(eq(usersTable.email, email));

// ‚ùå NESIGUR - NU FACE NICIODATƒÇ
const users = await db.execute(
  `SELECT * FROM users WHERE email = '${email}'`
);
```

### XSS Protection ‚úÖ

**Mecanism:** React auto-escaping

```typescript
// ‚úÖ SIGUR - React escapes automat
<div>{userInput}</div>

// ‚ö†Ô∏è PERICULOS - Folose»ôte doar cu sanitizare
import DOMPurify from 'dompurify';
const clean = DOMPurify.sanitize(dirtyHTML);
<div dangerouslySetInnerHTML={{ __html: clean }} />
```

### CSRF Protection üü°

**Status:** Par»õial implementat (JWT √Æn Authorization header oferƒÉ protec»õie)

**Recomandare Viitoare:**
```typescript
// AdaugƒÉ CSRF token √Æn formulare
<form>
  <input type="hidden" name="_csrf" value={csrfToken} />
  {/* ... */}
</form>
```

### Rate Limiting ‚ö†Ô∏è

**Status:** NecesitƒÉ implementare

**Recomandare:**
```typescript
import rateLimit from 'express-rate-limit';

const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minute
  max: 5,
  message: 'Prea multe √ÆncercƒÉri. √éncerca»õi peste 15 minute.'
});

app.post('/api/auth/login', loginLimiter, authController.login);
```

---

## Gestionarea Secretelor

### Hierarchy of Secrets

1. **Secrets Manager** (Produc»õie) - AWS Secrets Manager, HashiCorp Vault
2. **Environment Variables** (.env files) - Pentru development/staging
3. **Never in Code** - NiciodatƒÉ hardcodate √Æn cod

### .env File Security

```bash
# 1. AdaugƒÉ .env √Æn .gitignore
echo ".env" >> .gitignore
echo ".env.local" >> .gitignore
echo ".env.production" >> .gitignore

# 2. CreeazƒÉ .env.example (fƒÉrƒÉ valori reale)
cp .env .env.example
# EditeazƒÉ .env.example »ôi √Ænlocuie»ôte valori cu placeholders

# 3. SeteazƒÉ permisiuni restrictive
chmod 600 .env
```

### Secret Rotation

**Frecven»õƒÉ RecomandatƒÉ:**
- JWT_SECRET: La fiecare 90 zile
- Database passwords: La fiecare 90 zile
- API keys externe: Conform provider policy
- DupƒÉ orice incident de securitate: IMEDIAT

**ProcedurƒÉ Rota»õie JWT:**
```bash
# 1. GenereazƒÉ nou secret
NEW_SECRET=$(openssl rand -base64 64)

# 2. AdaugƒÉ ca JWT_SECRET_NEXT √Æn .env
JWT_SECRET_NEXT=$NEW_SECRET

# 3. ModificƒÉ backend sƒÉ accepte ambele
# (verificƒÉ token cu JWT_SECRET, apoi cu JWT_SECRET_NEXT)

# 4. DupƒÉ 24h, promoveazƒÉ:
JWT_SECRET=$NEW_SECRET
# »òterge JWT_SECRET_NEXT
```

---

## Deployment Securizat

### Pre-Deployment Checklist

```bash
# 1. Verificare vulnerabilitƒÉ»õi dependencies
npm audit --production
npm audit fix

# 2. Verificare secrete nu sunt √Æn cod
grep -r "password\|secret\|api[_-]key" apps/ libs/ \
  --include="*.ts" --include="*.tsx" | grep -v "process.env"

# 3. Verificare configurare .ENV production
cat .env.production | grep -E "SECRET|PASSWORD|KEY"
# Toate trebuie sƒÉ aibƒÉ valori unice, nu "changeme"!

# 4. Build production
npm run build

# 5. Test rulare production build local
npm run start:prod

# 6. Verificare logs √Æn production (nu trebuie sƒÉ aibƒÉ debug)
# AcceseazƒÉ aplica»õia »ôi verificƒÉ console
```

### Production Environment Setup

```bash
# 1. Server hardening
apt update && apt upgrade -y
ufw enable
ufw allow 443/tcp
ufw allow 80/tcp
ufw allow 22/tcp

# 2. SSL/TLS Configuration (Let's Encrypt)
certbot --nginx -d geniuserp.app -d www.geniuserp.app

# 3. Nginx reverse proxy cu security headers
# Vezi /configs/nginx.conf

# 4. Database configuration
# - SSL/TLS required
# - Strong password
# - Network isolation

# 5. Monitoring
# - Sentry pentru errors
# - Prometheus + Grafana pentru metrics
# - Wazuh pentru security events
```

### Docker Security

```yaml
# docker-compose.production.yml

services:
  backend:
    environment:
      - NODE_ENV=production
      - JWT_SECRET=${JWT_SECRET} # Din .env, nu hardcodat!
    networks:
      - internal # Nu expune direct
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
    
  database:
    environment:
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    networks:
      - internal # Doar backend acceseazƒÉ DB
    volumes:
      - postgres_data:/var/lib/postgresql/data:rw
    # NICIODATƒÇ expune portul 5432 public!
```

---

## Incident Response

### ProcedurƒÉ Incident de Securitate

#### 1. Detectare

**Indicatori de Compromis:**
- Tokeni JWT invalida»õi masiv
- Spike √Æn failed login attempts
- Access la date din companii nea autorizate
- ModificƒÉri neautorizate √Æn DB
- Erori Sentry neobi»ônuite

#### 2. Containment (Primele 15 minute)

```bash
# IMEDIAT:

# 1. Rote»ôte JWT secrets (invalideazƒÉ toate sesiunile)
NEW_JWT_SECRET=$(openssl rand -base64 64)
# ActualizeazƒÉ √Æn .env »ôi restart backend

# 2. VerificƒÉ logs pentru IP-uri suspecte
grep "Authentication failed" /var/log/geniuserp/backend.log | \
  awk '{print $1}' | sort | uniq -c | sort -rn

# 3. Block IP-uri mali»õioase √Æn firewall
ufw deny from [SUSPICIOUS_IP]

# 4. Backup database urgent
pg_dump geniuserp > /backups/incident-$(date +%Y%m%d_%H%M%S).sql

# 5. NotificƒÉ echipa
```

#### 3. Eradication (Primele 2 ore)

```bash
# 1. IdentificƒÉ breach point
# - VerificƒÉ Sentry errors
# - VerificƒÉ access logs
# - VerificƒÉ modifications √Æn DB

# 2. Patch vulnerabilitatea
# - ActualizeazƒÉ cod
# - Deploy fix urgent

# 3. Verificare nicio backdoor
grep -r "eval\|exec\|system" apps/ libs/
```

#### 4. Recovery

```bash
# 1. Restore de la backup dacƒÉ necesar
# 2. Verificare integritate date
# 3. Test complet func»õionalitate
# 4. Monitor √Æncontinuu pentru 48h
```

#### 5. Post-Incident

```markdown
# Incident Report Template

## Incident ID: INC-2025-XXX
**Data:** YYYY-MM-DD HH:MM
**Severitate:** Critical/High/Medium/Low
**Status:** Resolved/In Progress/Investigating

### Timeline
- HH:MM - Incident detectat
- HH:MM - Containment started
- HH:MM - Root cause identified
- HH:MM - Fix deployed
- HH:MM - Incident resolved

### Root Cause
[Descriere detaliatƒÉ]

### Impact
- Utilizatori afecta»õi: X
- Date compromise: Yes/No
- Downtime: X minute

### Remediere
1. [Ac»õiune 1]
2. [Ac»õiune 2]

### Prevention
1. [MƒÉsurƒÉ preventivƒÉ 1]
2. [MƒÉsurƒÉ preventivƒÉ 2]

### Lessons Learned
[Ce am √ÆnvƒÉ»õat]
```

---

## Security Checklist

### Development Checklist (Daily)

- [ ] Nu commit-ui niciodatƒÉ .env files
- [ ] Folose»ôte `logger` √Æn loc de `console.log`
- [ ] VerificƒÉ cƒÉ nicio parolƒÉ/secret nu e hardcodat
- [ ] Run `npm audit` √Ænainte de commit
- [ ] Review code pentru XSS vulnerabilities
- [ ] Test cu user input mali»õios

### Pre-Commit Checklist

```bash
# RuleazƒÉ automat cu git hooks

# 1. Linting
npm run lint

# 2. Type checking
npm run type-check

# 3. Security audit
npm audit

# 4. Check pentru secrete expuse
npm run security:check-secrets

# 5. Check pentru hardcoded data
npm run security:check-hardcoded
```

### Pre-Deployment Checklist (Production)

- [ ] ‚úÖ Toate .ENV vars configurate corect
- [ ] ‚úÖ JWT secrets generate securizat (NOT "changeme")
- [ ] ‚úÖ CORS origins set la domeniu production exact
- [ ] ‚úÖ Log level = "error" √Æn production
- [ ] ‚úÖ Sentry configurat »ôi testat
- [ ] ‚úÖ SSL/TLS certificat valid
- [ ] ‚úÖ Database backup automat configurat
- [ ] ‚úÖ Firewall configurat (ufw/iptables)
- [ ] ‚úÖ Rate limiting activat
- [ ] ‚úÖ npm audit fƒÉrƒÉ critical/high vulnerabilities
- [ ] ‚úÖ Monitoring »ôi alerting configurat
- [ ] ‚úÖ Incident response plan documented
- [ ] ‚úÖ Team awareness training completat

### Monthly Security Review

- [ ] Review access logs pentru activitate suspectƒÉ
- [ ] Update dependencies (npm update)
- [ ] Run security audit (npm audit)
- [ ] Review Sentry errors pentru patterns
- [ ] Verify backup restoration procedure
- [ ] Review user permissions »ôi roles
- [ ] Check pentru deprecated dependencies
- [ ] Review »ôi update documenta»õie securitate

### Quarterly Security Tasks

- [ ] Rota»õie JWT secrets
- [ ] Rota»õie database passwords
- [ ] External penetration testing
- [ ] Security training pentru echipƒÉ
- [ ] Review »ôi update incident response plan
- [ ] Audit complet conform OWASP
- [ ] Update security documentation

---

## Raportare VulnerabilitƒÉ»õi

### DacƒÉ Descoperi o Vulnerabilitate

**NU:**
- ‚ùå Nu posta public pe GitHub
- ‚ùå Nu distribui details √Ænainte de patch

**DA:**
1. ‚úÖ Email urgent la: security@geniuserp.app
2. ‚úÖ Include:
   - Descriere detaliatƒÉ
   - Steps to reproduce
   - Potential impact
   - Suggested fix (dacƒÉ ai)
3. ‚úÖ A»ôteaptƒÉ confirmare (rƒÉspuns √Æn 24h)
4. ‚úÖ Permite 90 zile pentru remediere √Ænainte de disclosure public

### Reward Program

VulnerabilitƒÉ»õi critice remediate rapid pot fi eligibile pentru:
- Credit √Æn SECURITY.md
- Bounty reward (dacƒÉ program activ)
- Mul»õumiri publice (cu permisiune)

---

## Resurse »ôi Referin»õe

### Standards »ôi Guidelines
- [OWASP Top 10 2021](https://owasp.org/Top10/)
- [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/)
- [CWE Top 25](https://cwe.mitre.org/top25/)

### Tools
- [Sentry](https://sentry.io) - Error tracking
- [Snyk](https://snyk.io) - Dependency scanning
- [npm audit](https://docs.npmjs.com/cli/v8/commands/npm-audit) - Vulnerability scanning

### Training
- [OWASP Secure Coding Practices](https://owasp.org/www-project-secure-coding-practices-quick-reference-guide/)
- [Web Security Academy](https://portswigger.net/web-security)

---

## Contact Security Team

**Email:** security@geniuserp.app  
**Response Time:** < 24h pentru critical, < 72h pentru high  
**PGP Key:** [Link to public key]

---

**Versiune Document:** 1.0.0  
**Ultima Actualizare:** 28 Octombrie 2025  
**UrmƒÉtoarea Revizuire:** Decembrie 2025


