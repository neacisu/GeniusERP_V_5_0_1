```
Step 37: Create or Upgrade Documents Module (Enterprise Archive, OCR, Signing, Registry)

ğŸ¯ Description:  
Ask the agent to first **search for an existing documents module** before generating a new one.  
The `documents` module will be a **comprehensive enterprise-grade system** that centralizes all document workflows in GeniusERP v.2.  
It must support:
- OCR & intelligent document parsing
- Full archive and versioning system
- PandaDoc-based eSignature flows
- Incoming/outgoing registry (Registru intrÄƒri/ieÈ™iri documente)
- Custom ERP templates for invoices, contracts, orders, etc.
- Embedded editor support
- Unique document indexing and auto-numbering
- Text + semantic content search (for OCR/metadata)
- Email & file attachments routing into archive

ğŸ“¦ Technologies:
- Backend: Express (modular NX structure)
- DB: PostgreSQL (Drizzle ORM)
- OCR: to be implemented in future steps
- Signing: PandaDoc via Axios
- Secrets: PANDADOC_API_KEY

ğŸ§± Dependencies:
- Step 36: SignDocumentService ready
- Step 34: DB tables (`documents`, `document_versions`) migrated

âš™ï¸ Instructions:

1. âœ… Verify existence of:
```
apps/api/src/modules/documents/documents.module.ts
```

- If it exists â†’ upgrade to include additional services & architecture
- If not â†’ create the module with proper structure

2. âœ… Create a base version:
```ts
// apps/api/src/modules/documents/documents.module.ts
import { SignDocumentService } from './services/sign-document.service';
import { ExchangeRateService } from '@/modules/currency/services/exchange-rate.service';
import { CreateDocumentService } from './services/create-document.service';

export class DocumentsModule {
  static register() {
    return {
      services: [
        SignDocumentService,
        CreateDocumentService,
        ExchangeRateService, // if needed in templates
        // (future) OCRService, DocumentRegistryService, TemplateService
      ],
    };
  }
}
```

3. âœ… Register in `apps/api/src/app.ts`:
```ts
import { DocumentsModule } from '@/modules/documents/documents.module';
const { services } = DocumentsModule.register();
```

ğŸ§ª Validation:
- All core services (signing, creation) accessible
- Module loads with no circular dependencies
- Cron or scheduler for registry/email/OCR can be added incrementally

ğŸ“ Notes:
- Structure this module into folders:
```
/schema      â†’ Drizzle tables
/services    â†’ OCR, Sign, Create, Registry, Search
/controllers â†’ API endpoints (upload, sign, archive, etc.)
/routes      â†’ POST /archive, /sign, /ocr, etc.
/templates   â†’ Stored ERP document templates
```

- Avoid any logic in the controller â€” fully delegate to services
- Max 100â€“150 LOC per file; respect granular principle throughout
```