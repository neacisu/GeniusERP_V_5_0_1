```
Step 30: Create Invoices Module (Granular + Express + Drizzle)

ğŸ¯ Description:  
Create a fully modular and granular `invoices` module to encapsulate all logic related to invoice management.  
This module must follow the **NX monorepo** and **feature-by-folder** structure, and import dependencies such as the **ExchangeRateService** from the `currency` module.  
It will serve as the foundation for draft/issue/send/cancel logic and e-Factura integration (see Section 4.1.4.2).

ğŸ“¦ Technologies:
- Backend: Express
- ORM: Drizzle
- Monorepo: NX (`apps/api/src/modules/invoices`)
- Architecture: Ultra-granular

ğŸ§± Dependencies:
- Step 26: `invoices` table migrated
- Step 29: `ExchangeRateService` ready in currency module

âš™ï¸ Instructions:

1. âœ… Create the following folder structure:
```
apps/api/src/modules/invoices/
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ create-invoice.controller.ts
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ create-invoice.route.ts
â”œâ”€â”€ services/
â”‚   â””â”€â”€ invoice.service.ts
â”œâ”€â”€ schema/
â”‚   â””â”€â”€ invoice.schema.ts     âœ… already exists
â”œâ”€â”€ validators/
â”‚   â””â”€â”€ create-invoice.validator.ts
â”œâ”€â”€ types/
â”‚   â””â”€â”€ invoice-status.enum.ts
â”‚   â””â”€â”€ invoice.input.ts
â”œâ”€â”€ invoices.module.ts        âœ… main module entrypoint
```

2. âœ… Create `invoices.module.ts`:
```ts
// apps/api/src/modules/invoices/invoices.module.ts
import { ExchangeRateService } from '@/modules/currency/services/exchange-rate.service';
import { InvoiceService } from './services/invoice.service';

export class InvoicesModule {
  static register() {
    return {
      services: [InvoiceService, ExchangeRateService],
    };
  }
}
```

3. âœ… Register it manually in `apps/api/src/app.ts` or main file:
```ts
import { InvoicesModule } from '@/modules/invoices/invoices.module';

const { services } = InvoicesModule.register();
const [invoiceService] = services;
```

ğŸ§ª Validation:
- Run `npm run build` â€” no missing services or modules
- Folder structure matches domain-driven, granular layout
- Files < 150 LOC each and independently testable

ğŸ“ Notes:
- All invoice lifecycle logic (Draft â†’ Issued â†’ Sent â†’ Canceled) goes in `invoice.service.ts`
- Break all major logic (e.g. issue, delete, allocate number) into separate services/controllers/routes
- This sets up the foundation for e-Factura, series control, and currency logic
```