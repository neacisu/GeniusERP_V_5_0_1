const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/company.service-DjT_lgpI.js","assets/index-BzQLEEGE.js","assets/index-DA4KwyIK.css"])))=>i.map(i=>d[i]);
import{j as e,g as J,h as K,ai as W,cr as X,aI as $,aH as V,bH as Y,ax as Z,ap as ee,L as se,B as c,bL as ae,u as le,r as n,ar as S,aF as te,cw as re,q as ie,I as ne,aJ as ce,aK as de,by as me,aM as xe,a3 as T,a4 as P,a5 as F,a6 as L,a7 as r,af as oe,ag as he,ah as D,ce as ue,cf as pe,v as je,cx as ge}from"./index-BzQLEEGE.js";import{C as ve}from"./CRMModuleLayout-Dn1kMNZ5.js";import{u as fe,i as E}from"./useCompanies-BIGKDgQA.js";const Ne=({customer:a})=>{const h=(l="lead")=>{switch(l.toLowerCase()){case"lead":return"outline";case"prospect":return"secondary";case"customer":return"default";case"partner":return"success";default:return"outline"}},g=(l="lead")=>({lead:"Lead",prospect:"Prospect",customer:"Client",partner:"Partener"})[l.toLowerCase()]||l,u=(l=0)=>l>=80?"text-green-600":l>=50?"text-amber-600":l>=30?"text-orange-600":"text-gray-600";return e.jsx(J,{className:"h-full shadow-sm hover:shadow-md transition-shadow",children:e.jsxs(K,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:a.name}),a.industry&&e.jsx("p",{className:"text-sm text-gray-600",children:a.industry})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(W,{variant:h(a.type),children:g(a.type)}),a.leadScore!==void 0&&e.jsxs("div",{className:`text-sm font-medium ${u(a.leadScore)}`,children:[a.leadScore," / 100"]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[(a.address||a.city)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(X,{className:"h-4 w-4 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[a.address&&e.jsx("div",{children:a.address}),a.city&&e.jsxs("div",{children:[a.city,a.county?`, ${a.county}`:""]})]})]}),a.phone&&e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("a",{href:`tel:${a.phone}`,className:"text-primary hover:underline",children:a.phone})]}),a.email&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("a",{href:`mailto:${a.email}`,className:"text-primary hover:underline",children:a.email})]}),a.website&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("a",{href:a.website,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:a.website.replace(/^https?:\/\/(www\.)?/i,"")})]}),a.fiscalCode&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsxs("span",{children:["CUI: ",a.fiscalCode]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"h-4 w-4 mr-1 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"0 contacte"})]}),e.jsx(se,{to:`/crm/customers/${a.id}`,children:e.jsxs(c,{variant:"outline",size:"sm",className:"flex items-center",children:[e.jsx("span",{children:"Detalii"}),e.jsx(ae,{className:"ml-1 h-4 w-4"})]})})]})]})})},Se=()=>{const{toast:a}=le(),[h,g]=n.useState(""),[u,l]=n.useState("grid"),[t,v]=n.useState("all"),[d,f]=n.useState("all"),[m,N]=n.useState("all"),[k,ye]=n.useState(1),[B]=n.useState(50),_={page:k,limit:B,searchTerm:h||void 0,sortBy:"name",sortDirection:"asc"},{data:y,isLoading:p,isError:C,error:I}=fe(_),j=(y==null?void 0:y.data)||[];console.log("[CustomersPage] Companies data loaded:",j.length,"companies");const A=[...new Set(j.map(s=>s.industry).filter(Boolean))],O=[...new Set(j.map(s=>{var o;return((o=s.customFields)==null?void 0:o.segment)||s.segment}).filter(Boolean))],x=j.filter(s=>{var z,M;const i=((z=s.customFields)==null?void 0:z.type)||s.type||"",o=t==="all"||i===t,b=((M=s.customFields)==null?void 0:M.segment)||s.segment||"",Q=d==="all"||b===d,q=m==="all"||s.industry===m;return o&&Q&&q}),[U,w]=n.useState(!1),R=()=>{w(!0)},G=async s=>{try{const{saveCompany:i}=await ge(async()=>{const{saveCompany:b}=await import("./company.service-DjT_lgpI.js");return{saveCompany:b}},__vite__mapDeps([0,1,2]));console.log("[CustomersPage] Trimitere date companie pentru salvare:",s);const o=await i(s);console.log("[CustomersPage] Companie salvată cu succes:",o),a({title:"Companie adăugată",description:`Compania ${s.name} a fost adăugată cu succes în baza de date.`}),E(),w(!1)}catch(i){console.error("[CustomersPage] Eroare la salvarea companiei:",i),a({title:"Eroare la salvarea companiei",description:i instanceof Error?i.message:"A apărut o eroare necunoscută",variant:"destructive"})}},H=()=>{v("all"),f("all"),N("all")};return e.jsx(ve,{activeTab:"customers",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Companii"})]}),e.jsxs(c,{onClick:R,className:"bg-primary hover:bg-primary/90",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Adaugă Companie"]})]}),e.jsx(re,{isOpen:U,onOpenChange:w,onSubmit:G}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 pb-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ie,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(ne,{placeholder:"Caută după nume, CUI sau email...",value:h,onChange:s=>g(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Filtre"]})}),e.jsx(xe,{align:"end",className:"w-60",children:e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tip"}),e.jsxs(T,{value:t,onValueChange:v,children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Toate tipurile"})}),e.jsxs(L,{children:[e.jsx(r,{value:"all",children:"Toate tipurile"}),e.jsx(r,{value:"lead",children:"Lead"}),e.jsx(r,{value:"prospect",children:"Prospect"}),e.jsx(r,{value:"customer",children:"Client"}),e.jsx(r,{value:"partner",children:"Partener"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Segment"}),e.jsxs(T,{value:d,onValueChange:f,children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Toate segmentele"})}),e.jsxs(L,{children:[e.jsx(r,{value:"all",children:"Toate segmentele"}),O.map(s=>s?e.jsx(r,{value:s,children:s},s):null)]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Industrie"}),e.jsxs(T,{value:m,onValueChange:N,children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Toate industriile"})}),e.jsxs(L,{children:[e.jsx(r,{value:"all",children:"Toate industriile"}),A.map(s=>s?e.jsx(r,{value:s,children:s},s):null)]})]})]}),e.jsx(c,{variant:"outline",className:"w-full mt-3",onClick:H,children:"Resetează filtre"})]})})]}),e.jsx("div",{className:"border rounded-md",children:e.jsx(oe,{value:u,onValueChange:s=>l(s),children:e.jsxs(he,{children:[e.jsx(D,{value:"grid",className:"px-2 py-1","aria-label":"Vizualizare grid",children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx(D,{value:"list",className:"px-2 py-1","aria-label":"Vizualizare listă",children:e.jsx(pe,{className:"h-4 w-4"})})]})})})]})]}),(t!=="all"||d!=="all"||m!=="all")&&e.jsxs("div",{className:"flex flex-wrap gap-2 pb-2",children:[t!=="all"&&e.jsxs("div",{className:"bg-primary/10 text-primary text-xs py-1 px-2.5 rounded-full flex items-center",children:["Tip: ",t==="customer"?"Client":t==="lead"?"Lead":t==="prospect"?"Prospect":"Partener",e.jsx("button",{className:"ml-1.5 text-primary/80 hover:text-primary",onClick:()=>v("all"),children:"✕"})]}),d!=="all"&&e.jsxs("div",{className:"bg-primary/10 text-primary text-xs py-1 px-2.5 rounded-full flex items-center",children:["Segment: ",d,e.jsx("button",{className:"ml-1.5 text-primary/80 hover:text-primary",onClick:()=>f("all"),children:"✕"})]}),m!=="all"&&e.jsxs("div",{className:"bg-primary/10 text-primary text-xs py-1 px-2.5 rounded-full flex items-center",children:["Industrie: ",m,e.jsx("button",{className:"ml-1.5 text-primary/80 hover:text-primary",onClick:()=>N("all"),children:"✕"})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:p?"Se încarcă companiile...":`${x.length} ${x.length===1?"companie":"companii"} găsite`}),p&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center",children:[e.jsx(je,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-lg",children:"Se încarcă companiile..."})]}),C&&e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"text-red-500 text-lg mb-4",children:"A apărut o eroare la încărcarea companiilor"}),e.jsx("p",{className:"text-gray-600",children:I instanceof Error?I.message:"Eroare necunoscută"}),e.jsx(c,{className:"mt-4",onClick:()=>E(),children:"Încearcă din nou"})]}),!p&&!C&&u==="grid"?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[x.map(s=>e.jsx(Ne,{customer:s},s.id)),x.length===0&&e.jsxs("div",{className:"col-span-full py-10 text-center",children:[e.jsx(S,{className:"h-10 w-10 mx-auto text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium",children:"Nicio companie găsită"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Ajustează filtrele sau adaugă o companie nouă."})]})]}):!p&&!C?e.jsxs("div",{className:"border rounded-md divide-y",children:[x.map(s=>e.jsxs("div",{className:"flex items-center p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h3",{className:"text-base font-medium",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 text-sm text-gray-500 mt-1",children:[s.industry&&e.jsx("span",{children:s.industry}),s.city&&e.jsx("span",{children:s.city}),s.cui&&e.jsxs("span",{children:["CUI: ",s.cui]}),!s.cui&&s.fiscalCode&&e.jsxs("span",{children:["CUI: ",s.fiscalCode]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.phone&&e.jsx(c,{size:"sm",variant:"outline",asChild:!0,children:e.jsxs("a",{href:`tel:${s.phone}`,children:[e.jsx($,{className:"h-3.5 w-3.5 mr-1"}),"Sună"]})}),s.email&&e.jsx(c,{size:"sm",variant:"outline",asChild:!0,children:e.jsxs("a",{href:`mailto:${s.email}`,children:[e.jsx(V,{className:"h-3.5 w-3.5 mr-1"}),"Email"]})}),e.jsx(c,{size:"sm",asChild:!0,children:e.jsx("a",{href:`/crm/customers/${s.id}`,children:"Detalii"})})]})]},s.id)),x.length===0&&e.jsxs("div",{className:"py-10 text-center",children:[e.jsx(S,{className:"h-10 w-10 mx-auto text-gray-400"}),e.jsx("h3",{className:"mt-4 text-lg font-medium",children:"Nicio companie găsită"}),e.jsx("p",{className:"mt-1 text-gray-500",children:"Ajustează filtrele sau adaugă o companie nouă."})]})]}):null]})})};export{Se as default};
