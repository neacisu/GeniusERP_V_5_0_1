import{u as ae,aw as E,al as D,bB as L,ak as H,r as A,j as e,y as se,D as re,E as V,G as b,H as ie,J as h,ai as U,aJ as ne,aK as te,B as w,cz as ce,aM as le,aN as G,M as oe,N as de,O as ue,P as me,Q as xe,R as he,U as pe,V as je,W as fe,X as ge,f as ve,t as be,z as t,F as Ne,i as p,k as j,l as f,m as g,I as N,o as v,n as y,T as Se,p as M,a3 as J,a4 as W,a5 as X,a6 as Y,a7 as P,b6 as z,b7 as ye,cJ as Ie,g as R,_ as $,$ as K,a0 as Q,ao as De,h as B,aS as Ae,aU as Ce,aV as we,aW as Fe,cG as Te,af as ze,ag as Ee,ah as F,aj as T,bu as I,a1 as Pe,b9 as ke}from"./index-BzQLEEGE.js";import{S as Z}from"./star-B070wT1J.js";function _(){const{toast:a}=ae();return{useInvoiceNumberingSettings:()=>H({queryKey:["/api/invoicing/numbering-settings"],queryFn:async()=>({data:await D({url:"/api/invoicing/numbering-settings",method:"GET"})})}),useInvoiceNumberingSetting:s=>H({queryKey:["/api/invoicing/numbering-settings",s],queryFn:async()=>await D({url:`/api/invoicing/numbering-settings/${s}`,method:"GET"}),enabled:!!s}),useCreateInvoiceNumberingSetting:()=>E({mutationFn:async s=>await D({url:"/api/invoicing/numbering-settings",method:"POST",data:s}),onSuccess:()=>{L.invalidateQueries({queryKey:["/api/invoicing/numbering-settings"]}),a({title:"Serie adăugată",description:"Seria de facturi a fost adăugată cu succes",variant:"success"})},onError:s=>{a({title:"Eroare",description:s.message||"A apărut o eroare la adăugarea seriei",variant:"destructive"})}}),useUpdateInvoiceNumberingSetting:()=>E({mutationFn:async({id:s,data:i})=>await D({url:`/api/invoicing/numbering-settings/${s}`,method:"PATCH",data:i}),onSuccess:(s,i)=>{L.invalidateQueries({queryKey:["/api/invoicing/numbering-settings"]}),i.data.isDefault?a({title:"Serie implicită actualizată",description:"Seria de facturi a fost setată ca implicită",variant:"success"}):a({title:"Serie actualizată",description:"Seria de facturi a fost actualizată cu succes",variant:"success"})},onError:s=>{a({title:"Eroare",description:s.message||"A apărut o eroare la actualizarea seriei",variant:"destructive"})}}),useDeleteInvoiceNumberingSetting:()=>E({mutationFn:async s=>await D({url:`/api/invoicing/numbering-settings/${s}`,method:"DELETE"}),onSuccess:()=>{L.invalidateQueries({queryKey:["/api/invoicing/numbering-settings"]}),a({title:"Serie ștearsă",description:"Seria de facturi a fost ștearsă cu succes",variant:"success"})},onError:s=>{a({title:"Eroare",description:s.message||"A apărut o eroare la ștergerea seriei",variant:"destructive"})}}),useGenerateInvoiceNumber:()=>E({mutationFn:async s=>await D({url:"/api/invoicing/numbering-settings/generate-number",method:"POST",data:{series:s}})})}}function qe({onEdit:a,onSetDefault:d}){const{useInvoiceNumberingSettings:u,useDeleteInvoiceNumberingSetting:l}=_(),{data:o,isLoading:m}=u(),r=(o==null?void 0:o.data)||[],s=l(),[i,x]=A.useState(!1),[S,C]=A.useState(null),k=c=>{C(c),x(!0)},q=()=>{S&&s.mutate(S),x(!1),C(null)};return m?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 animate-pulse rounded-md w-full"}),[...Array(3)].map((c,O)=>e.jsx("div",{className:"h-12 bg-gray-100 animate-pulse rounded-md w-full"},O))]}):e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(re,{children:e.jsxs(V,{children:[e.jsx(b,{children:"Serie"}),e.jsx(b,{children:"Descriere"}),e.jsx(b,{children:"Număr curent"}),e.jsx(b,{children:"Următorul număr"}),e.jsx(b,{children:"Prefix"}),e.jsx(b,{children:"Sufix"}),e.jsx(b,{children:"An"}),e.jsx(b,{children:"Status"}),e.jsx(b,{className:"text-right",children:"Acțiuni"})]})}),e.jsx(ie,{children:r.length===0?e.jsx(V,{children:e.jsx(h,{colSpan:9,className:"text-center py-6 text-muted-foreground",children:"Nu există setări de numerotare. Adăugați una nouă."})}):r.map(c=>e.jsxs(V,{children:[e.jsxs(h,{className:"font-medium",children:[c.isDefault&&e.jsxs(U,{variant:"secondary",className:"mr-2",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Implicit"]}),c.series]}),e.jsx(h,{children:c.description||"-"}),e.jsx(h,{children:c.lastNumber}),e.jsx(h,{className:"font-semibold",children:c.nextNumber}),e.jsx(h,{children:c.prefix||"-"}),e.jsx(h,{children:c.suffix||"-"}),e.jsx(h,{children:c.year||"-"}),e.jsx(h,{children:c.isActive?e.jsx(U,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Activ"}):e.jsx(U,{variant:"outline",children:"Inactiv"})}),e.jsx(h,{className:"text-right",children:e.jsxs(ne,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(w,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Deschide meniu"}),e.jsx(ce,{className:"h-4 w-4"})]})}),e.jsxs(le,{align:"end",children:[e.jsxs(G,{onClick:()=>a(c),children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Editează"]}),!c.isDefault&&e.jsxs(G,{onClick:()=>d(c.id),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Setează ca implicit"]}),e.jsxs(G,{onClick:()=>k(c.id),className:"text-destructive",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Șterge"]})]})]})})]},c.id))})]}),e.jsx(ue,{open:i,onOpenChange:x,children:e.jsxs(me,{children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Confirmați ștergerea"}),e.jsx(pe,{children:"Sigur doriți să ștergeți această serie de facturi? Această acțiune nu poate fi anulată."})]}),e.jsxs(je,{children:[e.jsx(fe,{children:"Anulează"}),e.jsx(ge,{onClick:q,className:"bg-destructive text-destructive-foreground",children:"Șterge"})]})]})})]})}const Oe=t.object({series:t.string().min(1,"Seria este obligatorie").max(10,"Seria poate avea maxim 10 caractere").regex(/^[A-Za-z0-9]+$/,"Seria poate conține doar litere și cifre"),description:t.string().max(100,"Descrierea poate avea maxim 100 caractere").optional(),nextNumber:t.coerce.number().int("Numărul trebuie să fie întreg").min(1,"Numărul trebuie să fie cel puțin 1"),prefix:t.string().max(10,"Prefixul poate avea maxim 10 caractere").optional(),suffix:t.string().max(10,"Sufixul poate avea maxim 10 caractere").optional(),year:t.coerce.number().int("Anul trebuie să fie întreg").min(2e3,"Anul trebuie să fie cel puțin 2000").max(2100,"Anul trebuie să fie cel mult 2100").optional(),warehouseId:t.string().uuid("ID depozit invalid").optional().nullable(),franchiseId:t.string().uuid("ID franciză invalid").optional().nullable(),isDefault:t.boolean().default(!1),isActive:t.boolean().default(!0)});function Le({setting:a,onSubmit:d,onCancel:u,warehouses:l=[],franchises:o=[]}){const m=!!a,r=ve({resolver:be(Oe),defaultValues:{series:(a==null?void 0:a.series)||"",description:(a==null?void 0:a.description)||"",nextNumber:(a==null?void 0:a.nextNumber)||1,prefix:(a==null?void 0:a.prefix)||"",suffix:(a==null?void 0:a.suffix)||"",year:(a==null?void 0:a.year)||new Date().getFullYear(),warehouseId:(a==null?void 0:a.warehouseId)||null,franchiseId:(a==null?void 0:a.franchiseId)||null,isDefault:(a==null?void 0:a.isDefault)||!1,isActive:(a==null?void 0:a.isActive)!==void 0?a.isActive:!0}});return A.useEffect(()=>{a?r.reset({series:a.series,description:a.description||"",nextNumber:a.nextNumber,prefix:a.prefix||"",suffix:a.suffix||"",year:a.year||new Date().getFullYear(),warehouseId:a.warehouseId||null,franchiseId:a.franchiseId||null,isDefault:a.isDefault,isActive:a.isActive}):r.reset({series:"",description:"",nextNumber:1,prefix:"",suffix:"",year:new Date().getFullYear(),warehouseId:null,franchiseId:null,isDefault:!1,isActive:!0})},[a,r]),e.jsx(Ne,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(d),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(p,{control:r.control,name:"series",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Serie factură*"}),e.jsx(g,{children:e.jsx(N,{placeholder:"FDI",disabled:m,...s})}),e.jsx(v,{children:"Seria poate conține litere și cifre (ex. FI, FDI24)"}),e.jsx(y,{})]})}),e.jsx(p,{control:r.control,name:"nextNumber",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Următorul număr*"}),e.jsx(g,{children:e.jsx(N,{placeholder:"1",type:"number",min:"1",...s})}),e.jsx(v,{children:"Numărul de la care vor începe facturile noi"}),e.jsx(y,{})]})})]}),e.jsx(p,{control:r.control,name:"description",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Descriere"}),e.jsx(g,{children:e.jsx(Se,{placeholder:"Descriere pentru această serie de facturi",className:"resize-none",...s})}),e.jsx(v,{children:"O descriere opțională pentru a identifica mai ușor această serie"}),e.jsx(y,{})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx(p,{control:r.control,name:"prefix",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Prefix"}),e.jsx(g,{children:e.jsx(N,{placeholder:"PREFIX-",...s})}),e.jsx(v,{children:"Text adăugat înaintea numărului"}),e.jsx(y,{})]})}),e.jsx(p,{control:r.control,name:"suffix",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Sufix"}),e.jsx(g,{children:e.jsx(N,{placeholder:"-SUFIX",...s})}),e.jsx(v,{children:"Text adăugat după număr"}),e.jsx(y,{})]})}),e.jsx(p,{control:r.control,name:"year",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"An"}),e.jsx(g,{children:e.jsx(N,{placeholder:new Date().getFullYear().toString(),type:"number",min:"2000",max:"2100",...s})}),e.jsx(v,{children:"Anul pentru această serie (opțional)"}),e.jsx(y,{})]})})]}),e.jsx(M,{}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[l.length>0&&e.jsx(p,{control:r.control,name:"warehouseId",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Depozit"}),e.jsxs(J,{onValueChange:i=>{s.onChange(i==="all"?null:i)},defaultValue:s.value||"all",children:[e.jsx(g,{children:e.jsx(W,{children:e.jsx(X,{placeholder:"Selectați un depozit"})})}),e.jsxs(Y,{children:[e.jsx(P,{value:"all",children:"Toate depozitele"}),l.map(i=>e.jsx(P,{value:i.id,children:i.name},i.id))]})]}),e.jsx(v,{children:"Seria va fi utilizată doar pentru acest depozit (opțional)"}),e.jsx(y,{})]})}),o.length>0&&e.jsx(p,{control:r.control,name:"franchiseId",render:({field:s})=>e.jsxs(j,{children:[e.jsx(f,{children:"Franciză"}),e.jsxs(J,{onValueChange:i=>{s.onChange(i==="all"?null:i)},defaultValue:s.value||"all",children:[e.jsx(g,{children:e.jsx(W,{children:e.jsx(X,{placeholder:"Selectați o franciză"})})}),e.jsxs(Y,{children:[e.jsx(P,{value:"all",children:"Toate francizele"}),o.map(i=>e.jsx(P,{value:i.id,children:i.name},i.id))]})]}),e.jsx(v,{children:"Seria va fi utilizată doar pentru această franciză (opțional)"}),e.jsx(y,{})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(p,{control:r.control,name:"isDefault",render:({field:s})=>e.jsxs(j,{className:"flex flex-row items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-base",children:"Serie implicită"}),e.jsx(v,{children:"Această serie va fi folosită automat pentru facturi noi"})]}),e.jsx(g,{children:e.jsx(z,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(p,{control:r.control,name:"isActive",render:({field:s})=>e.jsxs(j,{className:"flex flex-row items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-base",children:"Status activ"}),e.jsx(v,{children:"Dezactivați pentru a nu mai permite generarea de facturi noi"})]}),e.jsx(g,{children:e.jsx(z,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(w,{variant:"outline",onClick:u,type:"button",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Anulează"]}),e.jsx(w,{type:"submit",children:m?"Salvează modificări":"Adaugă serie"})]})]})})}function Ve(a){const[d,u]=A.useState({companyId:a}),l=H({queryKey:["franchises",d],queryFn:async()=>{let r="/api/companies/franchises";return d.companyId&&(r+=`?companyId=${d.companyId}`),await D({url:r,method:"GET"})}}),o=l.data&&l.data.success&&l.data.data?l.data.data:[],m=Array.isArray(o)?o.map(r=>({id:r.id,name:r.name})):[];return l.data&&(console.log("Franchise data from API:",l.data),console.log("Processed franchise options:",m)),{franchises:m,isLoading:l.isLoading,isError:l.isError,error:l.error,refetch:l.refetch,setFilter:u}}function Ue(){const{useUpdateInvoiceNumberingSetting:a,useCreateInvoiceNumberingSetting:d}=_(),u=a(),l=d(),{warehouses:o,isLoading:m}=Ie(),{franchises:r,isLoading:s}=Ve(),[i,x]=A.useState(!1),[S,C]=A.useState(null),k=()=>{C(null),x(!0)},q=n=>{C(n),x(!0)},c=()=>{x(!1),C(null)},O=n=>{u.mutate({id:n,data:{isDefault:!0}})},ee=n=>{S?u.mutate({id:S.id,data:{description:n.description,nextNumber:n.nextNumber,prefix:n.prefix,suffix:n.suffix,year:n.year,warehouseId:n.warehouseId,franchiseId:n.franchiseId,isDefault:n.isDefault,isActive:n.isActive}}):l.mutate({companyId:"",series:n.series,description:n.description,nextNumber:n.nextNumber,prefix:n.prefix,suffix:n.suffix,year:n.year,warehouseId:n.warehouseId,franchiseId:n.franchiseId,isDefault:n.isDefault,isActive:n.isActive}),x(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(R,{children:[e.jsxs($,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(K,{children:"Numerotare facturi"}),e.jsxs(Q,{children:["Configurează seriile și numerotarea facturilor conform cerințelor ANAF",(m||s)&&e.jsx("span",{className:"ml-2 text-xs text-muted-foreground",children:"Se încarcă datele..."})]})]}),e.jsxs(w,{onClick:k,className:"flex items-center gap-2",disabled:m||s,children:[e.jsx(De,{className:"h-4 w-4"}),"Adaugă serie"]})]}),e.jsx(B,{children:e.jsx(qe,{onEdit:q,onSetDefault:O})})]}),e.jsx(Ae,{open:i,onOpenChange:x,children:e.jsxs(Ce,{className:"max-w-3xl",children:[e.jsxs(we,{children:[e.jsx(Fe,{children:S?`Editare serie ${S.series}`:"Adaugă serie nouă"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configurați seriile și numerotarea pentru facturi conform reglementărilor"})]}),e.jsx(Le,{setting:S||void 0,onSubmit:ee,onCancel:c,warehouses:o||[],franchises:r||[]})]})})]})}t.object({series:t.string().min(1,"Seria este obligatorie").max(10,"Seria poate avea maxim 10 caractere").regex(/^[A-Za-z0-9]+$/,"Seria poate conține doar litere și cifre"),description:t.string().max(100,"Descrierea poate avea maxim 100 caractere").optional(),nextNumber:t.coerce.number().int("Numărul trebuie să fie întreg").min(1,"Numărul trebuie să fie cel puțin 1"),prefix:t.string().max(10,"Prefixul poate avea maxim 10 caractere").optional(),suffix:t.string().max(10,"Sufixul poate avea maxim 10 caractere").optional(),year:t.coerce.number().int("Anul trebuie să fie întreg").min(2e3,"Anul trebuie să fie cel puțin 2000").max(2100,"Anul trebuie să fie cel mult 2100").optional(),warehouseId:t.string().uuid("ID depozit invalid").optional().nullable(),franchiseId:t.string().uuid("ID franciză invalid").optional().nullable(),isDefault:t.boolean().default(!1),isActive:t.boolean().default(!0)});const Me=()=>{const[a,d]=A.useState("general"),u=()=>{};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Te,{title:"Setări facturare",description:"Configurează modulul de facturare"}),e.jsxs(ze,{defaultValue:"general",value:a,onValueChange:d,className:"space-y-5",children:[e.jsxs(Ee,{className:"grid grid-cols-4 sm:grid-cols-5 max-w-4xl",children:[e.jsx(F,{value:"general",children:"Generale"}),e.jsx(F,{value:"numbering",children:"Numerotare"}),e.jsx(F,{value:"taxes",children:"Fiscale"}),e.jsx(F,{value:"templates",children:"Șabloane"}),e.jsx(F,{value:"notifications",className:"hidden sm:block",children:"Notificări"})]}),e.jsxs(T,{value:"general",className:"space-y-5",children:[e.jsxs(R,{children:[e.jsxs($,{children:[e.jsx(K,{children:"Setări generale"}),e.jsx(Q,{children:"Configurări generale pentru modulul de facturare"})]}),e.jsx(B,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"auto-send",className:"font-medium",children:"Trimite facturi automat"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trimite automat facturile prin email după creare"})]}),e.jsx(z,{id:"auto-send"})]}),e.jsx(M,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"auto-remind",className:"font-medium",children:"Trimite reamintiri automate"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trimite reamintiri automate pentru facturile restante"})]}),e.jsx(z,{id:"auto-remind"})]}),e.jsx(M,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"auto-archive",className:"font-medium",children:"Arhivare automată"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Arhivează automat facturile plătite după 30 de zile"})]}),e.jsx(z,{id:"auto-archive"})]})]})})]}),e.jsxs(R,{children:[e.jsxs($,{children:[e.jsx(K,{children:"Informații companie"}),e.jsx(Q,{children:"Informațiile companiei care vor apărea pe facturi"})]}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"company-name",children:"Nume companie"}),e.jsx(N,{id:"company-name",placeholder:"Nume companie"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"company-cui",children:"CUI / CIF"}),e.jsx(N,{id:"company-cui",placeholder:"CUI / CIF"})]})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"company-reg",children:"Nr. Registrul Comerțului"}),e.jsx(N,{id:"company-reg",placeholder:"J12/123/2020"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"company-address",children:"Adresă"}),e.jsx(N,{id:"company-address",placeholder:"Adresa companiei"})]})]})]})]})]}),e.jsx(T,{value:"numbering",children:e.jsx(Ue,{})}),e.jsx(T,{value:"taxes",children:e.jsxs("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Pagină în dezvoltare"}),e.jsx("p",{className:"text-muted-foreground",children:"Această secțiune va fi disponibilă în curând."})]})}),e.jsx(T,{value:"templates",children:e.jsxs("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Pagină în dezvoltare"}),e.jsx("p",{className:"text-muted-foreground",children:"Această secțiune va fi disponibilă în curând."})]})}),e.jsx(T,{value:"notifications",children:e.jsxs("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Pagină în dezvoltare"}),e.jsx("p",{className:"text-muted-foreground",children:"Această secțiune va fi disponibilă în curând."})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs(w,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Resetează"]}),e.jsxs(w,{onClick:u,className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Salvează setări"]})]})]})};export{Me as default};
