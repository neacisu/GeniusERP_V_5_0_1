import{a as y,cK as S,u as b,r as a,cL as N,cM as w,j as t,cG as I,L as C,B as E,C as A,p as D,ba as p,bb as M,bc as h,bd as f,g as O,h as P,cN as T}from"./index-BzQLEEGE.js";function R(){const[F,g]=y(),{createInvoice:n}=S(),{toast:i}=b(),[x,c]=a.useState(!1),v={customerId:"",issueDate:new Date().toISOString().split("T")[0],dueDate:new Date(Date.now()+1e3*60*60*24*30).toISOString().split("T")[0],paymentMethod:w.BANK_TRANSFER,currency:"RON",notes:"",items:[{id:N(),productName:"Produs/Serviciu",productCode:"",quantity:1,unitPrice:0,vatRate:19,discount:0,unit:"buc"}]},[o,r]=a.useState(null),[u,l]=a.useState({}),j=async s=>{var d,m;console.log("New Invoice - Form submitted with data:",s),r(null),l({});try{c(!0),l({formData:s,paymentMethodType:typeof s.paymentMethod,paymentMethodValue:s.paymentMethod,itemsCount:((d=s.items)==null?void 0:d.length)||0}),console.log("Creating invoice with data:",JSON.stringify(s,null,2));const e=await n.mutateAsync(s);console.log("Create invoice result:",e),i({title:"Succes",description:"Factura a fost creată cu succes",variant:"default"}),g("/facturare/invoices")}catch(e){r((e==null?void 0:e.message)||"A apărut o eroare la crearea facturii"),console.error("Error creating invoice:",e),console.error("Error details:",{name:e==null?void 0:e.name,message:e==null?void 0:e.message,stack:e==null?void 0:e.stack,response:(m=e==null?void 0:e.response)==null?void 0:m.data}),i({title:"Eroare",description:`Nu s-a putut crea factura: ${(e==null?void 0:e.message)||"Eroare necunoscută"}`,variant:"destructive"})}finally{c(!1)}};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx(I,{title:"Factură nouă",description:"Creează o factură nouă pentru un client"}),t.jsx(C,{href:"/facturare/invoices",children:t.jsxs(E,{variant:"outline",children:[t.jsx(A,{className:"mr-2 h-4 w-4"}),"Înapoi la facturi"]})})]}),t.jsx(D,{}),o&&t.jsxs(p,{variant:"destructive",children:[t.jsx(M,{className:"h-4 w-4"}),t.jsx(h,{children:"Eroare la crearea facturii"}),t.jsx(f,{children:o})]}),Object.keys(u).length>0&&t.jsxs(p,{children:[t.jsx(h,{children:"Informații de depanare"}),t.jsx(f,{children:t.jsx("pre",{className:"mt-2 w-full rounded-md bg-slate-950 p-4 text-xs text-white overflow-auto",children:JSON.stringify(u,null,2)})})]}),t.jsx(O,{children:t.jsx(P,{className:"pt-6",children:t.jsx(T,{defaultValues:v,onSubmit:j,isSubmitting:x||n.isPending})})})]})}export{R as default};
